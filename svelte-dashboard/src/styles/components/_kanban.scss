// Design System - Kanban Board Components (Drag & Drop Interface)
// ================================================================

@import '../variables';
@import '../mixins';

// KANBAN BOARD CONTAINER
// ======================
.kanban-board {
  display: flex;
  gap: $space-6;
  padding: $space-6;
  overflow-x: auto;
  min-height: 600px;
  
  @include scroll-custom;
  
  // Smooth scrolling
  scroll-behavior: smooth;
}

// KANBAN COLUMN
// =============
.kanban-column {
  @include card-base;
  min-width: 300px;
  width: 300px;
  max-height: 80vh;
  display: flex;
  flex-direction: column;
  position: relative;
  
  // Drop zone styling
  &--drop-active {
    border-color: rgba($primary-500, 0.5);
    background: rgba($primary-500, 0.03);
    transform: scale(1.02);
    
    &::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      border-radius: $rounded-lg;
      background: linear-gradient(135deg, $primary-500, $primary-600);
      z-index: -1;
      animation: pulse-border 1.5s infinite;
    }
  }
  
  &--drop-invalid {
    border-color: rgba($error-500, 0.5);
    background: rgba($error-500, 0.03);
  }
  
  @include mobile-only {
    min-width: 280px;
    width: 280px;
  }
}

// KANBAN COLUMN HEADER
// ====================
.kanban-column__header {
  padding: $space-5 $space-5 $space-4 $space-5;
  border-bottom: 1px solid rgba($neutral-700, 0.3);
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: relative;
  
  &::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: $space-5;
    right: $space-5;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba($neutral-600, 0.5), transparent);
  }
}

.kanban-column__title {
  @include body-base;
  font-weight: $font-semibold;
  color: $neutral-100;
  display: flex;
  align-items: center;
  gap: $space-2;
  margin: 0;
  flex: 1;
  
  // Status indicator
  &::before {
    content: '';
    width: 8px;
    height: 8px;
    border-radius: $rounded-full;
    background-color: currentColor;
    opacity: 0.6;
  }
  
  // Column-specific colors
  &--not-started::before {
    background-color: $neutral-500;
  }
  
  &--progress::before {
    background-color: $info-500;
  }
  
  &--testing::before {
    background-color: $warning-500;
  }
  
  &--complete::before {
    background-color: $success-500;
  }
  
  &--blocked::before {
    background-color: $error-500;
  }
}

.kanban-column__count {
  @include body-small;
  color: $neutral-400;
  background: rgba($neutral-700, 0.4);
  padding: $space-1 $space-2;
  border-radius: $rounded-full;
  font-weight: $font-medium;
  min-width: 24px;
  text-align: center;
}

.kanban-column__actions {
  display: flex;
  align-items: center;
  gap: $space-2;
  
  .btn {
    padding: $space-1;
    width: 24px;
    height: 24px;
    
    svg {
      width: 12px;
      height: 12px;
    }
  }
}

// KANBAN COLUMN CONTENT
// =====================
.kanban-column__content {
  flex: 1;
  padding: $space-4;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: $space-3;
  
  @include scroll-custom;
  
  // Empty state
  &--empty {
    align-items: center;
    justify-content: center;
    color: $neutral-500;
    padding: $space-8 $space-4;
    
    .empty-state__message {
      @include body-small;
      text-align: center;
      margin-top: $space-3;
    }
    
    .empty-state__icon {
      width: 32px;
      height: 32px;
      opacity: 0.5;
    }
  }
}

// KANBAN CARD (Individual items)
// ===============================
.kanban-card {
  @include card-base;
  padding: $space-4;
  cursor: grab;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  border: 1px solid rgba($neutral-700, 0.4);
  
  &:hover {
    transform: translateY(-2px);
    box-shadow: 
      0 8px 25px rgba(0, 0, 0, 0.3),
      0 0 0 1px rgba($primary-500, 0.2);
    border-color: rgba($primary-500, 0.3);
  }
  
  &:active {
    cursor: grabbing;
  }
  
  // Dragging state
  &--dragging {
    transform: rotate(5deg) scale(1.05);
    cursor: grabbing;
    z-index: 1000;
    opacity: 0.8;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
    
    &::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba($primary-500, 0.1), rgba($primary-600, 0.1));
      border-radius: $rounded-lg;
      pointer-events: none;
    }
  }
  
  &--selected {
    border-color: $primary-500;
    background: rgba($primary-500, 0.05);
    
    &::before {
      content: '';
      position: absolute;
      top: -1px;
      left: -1px;
      right: -1px;
      bottom: -1px;
      background: linear-gradient(135deg, $primary-500, $primary-600);
      border-radius: $rounded-lg;
      z-index: -1;
      opacity: 0.5;
    }
  }
}

// KANBAN CARD CONTENT
// ===================
.kanban-card__priority {
  position: absolute;
  top: $space-3;
  right: $space-3;
  width: 8px;
  height: 8px;
  border-radius: $rounded-full;
  
  &--high {
    background-color: $error-500;
    box-shadow: 0 0 8px rgba($error-500, 0.4);
  }
  
  &--medium {
    background-color: $warning-500;
    box-shadow: 0 0 8px rgba($warning-500, 0.4);
  }
  
  &--low {
    background-color: $info-500;
    box-shadow: 0 0 8px rgba($info-500, 0.4);
  }
}

.kanban-card__id {
  @include body-small;
  color: $neutral-500;
  font-family: $font-family-mono;
  font-weight: $font-medium;
  margin-bottom: $space-2;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.kanban-card__title {
  @include body-base;
  color: $neutral-100;
  font-weight: $font-medium;
  margin-bottom: $space-3;
  line-height: $leading-snug;
  padding-right: $space-4; // Account for priority indicator
}

.kanban-card__description {
  @include body-small;
  color: $neutral-400;
  line-height: $leading-relaxed;
  margin-bottom: $space-4;
  
  // Clamp to 3 lines
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.kanban-card__tags {
  display: flex;
  flex-wrap: wrap;
  gap: $space-2;
  margin-bottom: $space-4;
}

.kanban-card__tag {
  @include body-small;
  background: rgba($neutral-700, 0.5);
  color: $neutral-300;
  padding: $space-1 $space-2;
  border-radius: $rounded;
  font-weight: $font-medium;
  font-size: $text-xs;
  
  &--category {
    background: rgba($primary-500, 0.15);
    color: $primary-300;
    border: 1px solid rgba($primary-500, 0.3);
  }
  
  &--effort {
    background: rgba($info-500, 0.15);
    color: $info-300;
    border: 1px solid rgba($info-500, 0.3);
  }
}

// KANBAN CARD FOOTER
// ==================
.kanban-card__footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: $space-3;
  padding-top: $space-3;
  border-top: 1px solid rgba($neutral-800, 0.5);
}

.kanban-card__assignee {
  display: flex;
  align-items: center;
  gap: $space-2;
  
  &__avatar {
    width: 20px;
    height: 20px;
    border-radius: $rounded-full;
    background: linear-gradient(135deg, $primary-500, $primary-600);
    color: $neutral-0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: $text-xs;
    font-weight: $font-bold;
  }
  
  &__name {
    @include body-small;
    color: $neutral-300;
    font-weight: $font-medium;
  }
}

.kanban-card__meta {
  display: flex;
  align-items: center;
  gap: $space-3;
}

.kanban-card__effort {
  @include body-small;
  color: $neutral-500;
  font-weight: $font-medium;
  display: flex;
  align-items: center;
  gap: $space-1;
  
  &::before {
    content: '‚è±';
    opacity: 0.7;
  }
}

.kanban-card__comments {
  @include body-small;
  color: $neutral-500;
  display: flex;
  align-items: center;
  gap: $space-1;
  
  svg {
    width: 12px;
    height: 12px;
  }
}

// KANBAN BOARD ACTIONS
// ====================
.kanban-board__toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: $space-4 $space-6;
  background: rgba($neutral-850, 0.9);
  border-bottom: 1px solid rgba($neutral-700, 0.3);
  
  &__left {
    display: flex;
    align-items: center;
    gap: $space-4;
  }
  
  &__right {
    display: flex;
    align-items: center;
    gap: $space-3;
  }
  
  &__title {
    @include heading-3;
    color: $neutral-100;
    margin: 0;
  }
  
  &__filters {
    display: flex;
    align-items: center;
    gap: $space-2;
  }
  
  &__view-toggle {
    display: flex;
    background: rgba($neutral-800, 0.5);
    border-radius: $rounded-md;
    padding: $space-1;
    
    .btn {
      padding: $space-2 $space-3;
      border-radius: $rounded-sm;
      font-size: $text-sm;
      
      &--active {
        @include button-primary;
      }
    }
  }
}

// ADD CARD BUTTON
// ===============
.kanban-add-card {
  @include button-ghost;
  width: 100%;
  justify-content: center;
  border: 2px dashed rgba($neutral-600, 0.5);
  background: rgba($neutral-800, 0.2);
  padding: $space-4;
  margin-top: $space-2;
  
  &:hover {
    border-color: rgba($primary-500, 0.5);
    background: rgba($primary-500, 0.05);
    color: $primary-300;
  }
  
  &__icon {
    width: 16px;
    height: 16px;
    margin-right: $space-2;
  }
}

// KANBAN ANIMATIONS
// =================
@keyframes pulse-border {
  0%, 100% {
    opacity: 0.3;
  }
  50% {
    opacity: 0.8;
  }
}

// Smooth transitions for card movements
.kanban-card-move {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

// RESPONSIVE KANBAN BEHAVIOR
// ==========================
@include mobile-only {
  .kanban-board {
    padding: $space-4;
    gap: $space-4;
  }
  
  .kanban-column {
    min-width: 260px;
    width: 260px;
  }
  
  .kanban-board__toolbar {
    flex-direction: column;
    align-items: stretch;
    gap: $space-3;
    
    &__left,
    &__right {
      justify-content: space-between;
    }
  }
}

@include tablet-up {
  .kanban-board--compact {
    .kanban-column {
      min-width: 250px;
      width: 250px;
    }
    
    .kanban-card {
      padding: $space-3;
    }
    
    .kanban-card__title {
      font-size: $text-sm;
      margin-bottom: $space-2;
    }
    
    .kanban-card__description {
      display: none; // Hide in compact view
    }
  }
}

// ACCESSIBILITY ENHANCEMENTS
// ===========================
@media (prefers-reduced-motion: reduce) {
  .kanban-card,
  .kanban-column {
    transition: none;
  }
  
  .kanban-card--dragging {
    transform: none;
  }
  
  @keyframes pulse-border {
    0%, 100% {
      opacity: 0.5;
    }
  }
}

// Keyboard navigation support
.kanban-card:focus-visible {
  outline: 2px solid $primary-500;
  outline-offset: 2px;
}

.kanban-column:focus-within {
  border-color: rgba($primary-500, 0.3);
}

// High contrast support
@media (prefers-contrast: high) {
  .kanban-card {
    border-width: 2px;
  }
  
  .kanban-column {
    border-width: 2px;
  }
  
  .kanban-add-card {
    border-width: 3px;
  }
}